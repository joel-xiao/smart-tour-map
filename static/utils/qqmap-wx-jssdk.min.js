var _createClass=function(){function a(e,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||false;d.configurable=true;if("value" in d){d.writable=true}Object.defineProperty(e,d.key,d)}}return function(d,b,c){if(b){a(d.prototype,b)}if(c){a(d,c)}return d}}();function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var ERROR_CONF={KEY_ERR:311,KEY_ERR_MSG:"key格式错误",PARAM_ERR:310,PARAM_ERR_MSG:"请求参数信息有误",SYSTEM_ERR:600,SYSTEM_ERR_MSG:"系统错误",WX_ERR_CODE:1000,WX_OK_CODE:200};var BASE_URL="https://apis.map.qq.com/ws/";var URL_SEARCH=BASE_URL+"place/v1/search";var URL_SUGGESTION=BASE_URL+"place/v1/suggestion";var URL_GET_GEOCODER=BASE_URL+"geocoder/v1/";var URL_CITY_LIST=BASE_URL+"district/v1/list";var URL_AREA_LIST=BASE_URL+"district/v1/getchildren";var URL_DISTANCE=BASE_URL+"distance/v1/";var URL_DIRECTION=BASE_URL+"direction/v1/";var MODE={driving:URL_DIRECTION+"driving",walking:URL_DIRECTION+"walking",transit:URL_DIRECTION+"transit",bicycling:URL_DIRECTION+"bicycling"};var Utils={safeAdd:function(a,b){var c=(a&65535)+(b&65535);var d=(a>>16)+(b>>16)+(c>>16);return(d<<16)|(c&65535)},bitRotateLeft:function(a,b){return(a<<b)|(a>>>(32-b))},md5cmn:function(f,h,g,e,d,c){return this.safeAdd(this.bitRotateLeft(this.safeAdd(this.safeAdd(h,f),this.safeAdd(e,c)),d),g)},md5ff:function(h,g,k,j,e,d,i){return this.md5cmn((g&k)|((~g)&j),h,g,e,d,i)},md5gg:function(h,g,k,j,e,d,i){return this.md5cmn((g&j)|(k&(~j)),h,g,e,d,i)},md5hh:function(h,g,k,j,e,d,i){return this.md5cmn(g^k^j,h,g,e,d,i)},md5ii:function(h,g,k,j,e,d,i){return this.md5cmn(k^(g|(~j)),h,g,e,d,i)},binlMD5:function(n,k){n[k>>5]|=128<<(k%32);n[((k+64)>>>9<<4)+14]=k;var m=1732584193;var l=-271733879;var j=-1732584194;var h=271733878;for(var g=0;g<n.length;g+=16){var f=m;var e=l;var d=j;var c=h;m=this.md5ff(m,l,j,h,n[g],7,-680876936);h=this.md5ff(h,m,l,j,n[g+1],12,-389564586);j=this.md5ff(j,h,m,l,n[g+2],17,606105819);l=this.md5ff(l,j,h,m,n[g+3],22,-1044525330);m=this.md5ff(m,l,j,h,n[g+4],7,-176418897);h=this.md5ff(h,m,l,j,n[g+5],12,1200080426);j=this.md5ff(j,h,m,l,n[g+6],17,-1473231341);l=this.md5ff(l,j,h,m,n[g+7],22,-45705983);m=this.md5ff(m,l,j,h,n[g+8],7,1770035416);h=this.md5ff(h,m,l,j,n[g+9],12,-1958414417);j=this.md5ff(j,h,m,l,n[g+10],17,-42063);l=this.md5ff(l,j,h,m,n[g+11],22,-1990404162);m=this.md5ff(m,l,j,h,n[g+12],7,1804603682);h=this.md5ff(h,m,l,j,n[g+13],12,-40341101);j=this.md5ff(j,h,m,l,n[g+14],17,-1502002290);l=this.md5ff(l,j,h,m,n[g+15],22,1236535329);m=this.md5gg(m,l,j,h,n[g+1],5,-165796510);h=this.md5gg(h,m,l,j,n[g+6],9,-1069501632);j=this.md5gg(j,h,m,l,n[g+11],14,643717713);l=this.md5gg(l,j,h,m,n[g],20,-373897302);m=this.md5gg(m,l,j,h,n[g+5],5,-701558691);h=this.md5gg(h,m,l,j,n[g+10],9,38016083);j=this.md5gg(j,h,m,l,n[g+15],14,-660478335);l=this.md5gg(l,j,h,m,n[g+4],20,-405537848);m=this.md5gg(m,l,j,h,n[g+9],5,568446438);h=this.md5gg(h,m,l,j,n[g+14],9,-1019803690);j=this.md5gg(j,h,m,l,n[g+3],14,-187363961);l=this.md5gg(l,j,h,m,n[g+8],20,1163531501);m=this.md5gg(m,l,j,h,n[g+13],5,-1444681467);h=this.md5gg(h,m,l,j,n[g+2],9,-51403784);j=this.md5gg(j,h,m,l,n[g+7],14,1735328473);l=this.md5gg(l,j,h,m,n[g+12],20,-1926607734);m=this.md5hh(m,l,j,h,n[g+5],4,-378558);h=this.md5hh(h,m,l,j,n[g+8],11,-2022574463);j=this.md5hh(j,h,m,l,n[g+11],16,1839030562);l=this.md5hh(l,j,h,m,n[g+14],23,-35309556);m=this.md5hh(m,l,j,h,n[g+1],4,-1530992060);h=this.md5hh(h,m,l,j,n[g+4],11,1272893353);j=this.md5hh(j,h,m,l,n[g+7],16,-155497632);l=this.md5hh(l,j,h,m,n[g+10],23,-1094730640);m=this.md5hh(m,l,j,h,n[g+13],4,681279174);h=this.md5hh(h,m,l,j,n[g],11,-358537222);j=this.md5hh(j,h,m,l,n[g+3],16,-722521979);l=this.md5hh(l,j,h,m,n[g+6],23,76029189);m=this.md5hh(m,l,j,h,n[g+9],4,-640364487);h=this.md5hh(h,m,l,j,n[g+12],11,-421815835);j=this.md5hh(j,h,m,l,n[g+15],16,530742520);l=this.md5hh(l,j,h,m,n[g+2],23,-995338651);m=this.md5ii(m,l,j,h,n[g],6,-198630844);h=this.md5ii(h,m,l,j,n[g+7],10,1126891415);j=this.md5ii(j,h,m,l,n[g+14],15,-1416354905);l=this.md5ii(l,j,h,m,n[g+5],21,-57434055);m=this.md5ii(m,l,j,h,n[g+12],6,1700485571);h=this.md5ii(h,m,l,j,n[g+3],10,-1894986606);j=this.md5ii(j,h,m,l,n[g+10],15,-1051523);l=this.md5ii(l,j,h,m,n[g+1],21,-2054922799);m=this.md5ii(m,l,j,h,n[g+8],6,1873313359);h=this.md5ii(h,m,l,j,n[g+15],10,-30611744);j=this.md5ii(j,h,m,l,n[g+6],15,-1560198380);l=this.md5ii(l,j,h,m,n[g+13],21,1309151649);m=this.md5ii(m,l,j,h,n[g+4],6,-145523070);h=this.md5ii(h,m,l,j,n[g+11],10,-1120210379);j=this.md5ii(j,h,m,l,n[g+2],15,718787259);l=this.md5ii(l,j,h,m,n[g+9],21,-343485551);m=this.safeAdd(m,f);l=this.safeAdd(l,e);j=this.safeAdd(j,d);h=this.safeAdd(h,c)}return[m,l,j,h]},binl2rstr:function(c){var b="";for(var a=0;a<c.length*32;a+=8){b+=String.fromCharCode((c[a>>5]>>>(a%32))&255)}return b},rstr2binl:function(b){var a=[];a[(b.length>>2)-1]=undefined;for(var c=0;c<a.length;c+=1){a[c]=0}for(var c=0;c<b.length*8;c+=8){a[c>>5]|=(b.charCodeAt(c/8)&255)<<(c%32)}return a},rstrMD5:function(a){return this.binl2rstr(this.binlMD5(this.rstr2binl(a),a.length*8))},rstrHMACMD5:function(c,f){var e=this.rstr2binl(c);var a=[];var d=[];a[15]=d[15]=undefined;if(e.length>16){e=this.binlMD5(e,c.length*8)}for(var b=0;b<16;b+=1){a[b]=e[b]^909522486;d[b]=e[b]^1549556828}var g=this.binlMD5(a.concat(this.rstr2binl(f)),512+f.length*8);return this.binl2rstr(this.binlMD5(d.concat(g),512+128))},rstr2hex:function(b){var a="0123456789abcdef";var d="";for(var c=0;c<b.length;c+=1){var e=b.charCodeAt(c);d+=a.charAt((e>>>4)&15)+a.charAt(e&15)}return d},str2rstrUTF8:function(a){return unescape(encodeURIComponent(a))},raw2rstrUTF8:function(a){return unescape(encodeURIComponent(a))},rawMD5:function(a){return this.rstrMD5(this.str2rstrUTF8(a))},rawHMACMD5:function(b,a){return this.rstrHMACMD5(this.str2rstrUTF8(b),this.str2rstrUTF8(a))},hexMD5:function(a){return this.rstr2hex(this.rawMD5(a))},hexHMACMD5:function(b,a){return this.rstr2hex(this.rawHMACMD5(b,a))},md5:function(a,b,c){if(!b){if(!c){return this.hexMD5(a)}return this.rawMD5(a)}if(!c){return this.hexHMACMD5(b,a)}return this.rawHMACMD5(b,a)},getSig:function(b,a,c){return this.md5(b+a+c)},quote:function(a){return encodeURIComponent(a)}};var QQMapWX=function(){function b(i){_classCallCheck(this,b);if(!i.key){throw Error("key值不能为空")}this.key=i.key}_createClass(b,[{key:"request",value:function f(i){var j=i.url;var k=i.data;var n=(i.header={});var m=i.method||"GET";var l=i.success||function(){};var o=i.fail||function(){};var p=i.complete||function(){};var r=k;var q=function(){wx.request({url:j,data:k,header:n,method:m,success:function(s){s&&s.data&&s.data.status!==0?o(s):l(s);p(s)},fail:function(s){o(s);p(s)}})};if(/apis\.map\.qq\.com/g.test(j)&&!k.sig){var k=Object.assign({},k,{key:this.key});var j=j+"?"+Object.keys(k).filter(function(t){return !!k[t]}).concat(Object.keys(r).filter(function(t){return r[t]!==k[t]&&!!r[t]})).map(function(t){return t+"="+k[t]}).join("&");q(j,k)}else{if(j.match(/apis\.map\.qq\.com.*sig/gi)){q(j,k)}else{q(j,k)}}return j}},{key:"getWxLocation",value:function e(j,i,k){wx.getLocation({type:"gcj02",success:function(l){var m=l.longitude+","+l.latitude;j(m)},fail:function(l){i(l)},complete:function(l){k(l)}})}},{key:"getLocation",value:function e(l){var i=this;var k=l.success||function(m){};var j=l.fail||function(m){};i.getWxLocation(k,j,function(m){})}},{key:"search",value:function a(i){var j=i.keyword;if(j.length<=0){return Error("search keyword cannot be null!")}var k={};k.keyword=j;var n=i.region||"";k.region=n;var m=i.referer||"wxcharts";k.referer=m;var l=i.get_poi;if(l){k.get_poi=1}var o=i.success||function(){};var p=i.fail||function(){};var q=i.complete||function(){};k.key=this.key;k.output="json";k.filter=i.filter;this.request({url:URL_SEARCH,data:k,success:function(r){var r=r.data;if(r.status===0){var s=r.data;o({status:0,count:s.count,data:s.data})}else{p({status:r.status,message:r.message})}},fail:function(r){p({status:-1,message:r.errMsg||""})}});return{};return this.request({url:URL_SEARCH,data:k,success:function(r){var r=r.data;if(r.status===0){var s=r.data;o({status:0,count:s.count,data:s.data,suggestion:r.data.suggestion,keyword:j})}else{p({status:r.status,message:r.message})}},fail:function(r){p({status:-1,message:r.errMsg||""})},complete:function(r){q(r)}})}},{key:"getSuggestion",value:function g(i){var j=i.keyword;var k=i.region;var n=i.region_fix;var l=i.policy;var o=i.get_subpois;var m=i.success||function(){};var p=i.fail||function(){};var q=i.complete||function(){};var r={};r.key=this.key;r.output="json";r.region=k||"";r.region_fix=n||0;r.policy=l||0;r.get_subpois=o||0;r.keyword=j;this.request({url:URL_SUGGESTION,data:r,success:function(t){var s=t.data;if(s.status===0){var u=s.data;m({status:0,count:u.count,data:u})}else{p({status:s.status,message:s.message})}},fail:function(s){p({status:-1,message:s.errMsg||""})},complete:function(s){q(s)}})}},{key:"reverseGeocoder",value:function d(i){var j={};var o=null;var n=null;var p=null;if(i.location){o=i.location.latitude;n=i.location.longitude}var r=i.coord_type||"5";j.coord_type=r;var s=i.get_poi||0;if(s){j.get_poi=s}var k=i.poi_options||null;var q=i.successif(k){j.poi_options=k.policy+","+k.radius+","+k.classification}var l=i.get_admin||0;j.get_admin=l;var m=i.success||function(){};var t=i.fail||function(){};var u=i.complete||function(){};var v=this;if((o==null||n==null)&&v.getWxLocation){v.getWxLocation(function(w){j.location=w;v.request({url:URL_GET_GEOCODER,data:j,success:function(y){var z=y.data;if(z.status===0){var x=z.result;m({status:0,result:x,message:z.message||""})}else{t({status:z.status,message:z.message||""})}},fail:function(x){t({status:-1,message:x.errMsg||""})},complete:function(x){u(x)}})},t,u);return}j.location=n+","+o;this.request({url:URL_GET_GEOCODER,data:j,success:function(x){var y=x.data;if(y.status===0){var w=y.result;m({status:0,result:w,message:y.message||""})}else{t({status:y.status,message:y.message||})}},fail:function(w){t({status:-1,message:w.errMsg||""})},complete:function(w){u(w)}})}},{key:"geocoder",value:function h(i){var j={};var k=i.address||"";j.address=k;var m=i.region||"";j.region=m;var n=i.success||function(){};var l=i.fail||function(){};var o=i.complete||function(){};j.key=this.key;j.output="json";if(k.length<=0){return Error("geocoder address cannot be null!")}this.request({url:URL_GET_GEOCODER,data:j,header:{content:"application/json"},method:"get",success:function(q){var r=q.data;if(r.status===0){var p=r.result;n({status:0,result:p})}else{l({status:r.status,message:r.message})}},fail:function(p){l({status:-1,message:p.errMsg||""})},complete:function(p){o(p)}})}},{key:"getCityList",value:function c(i){var k={};var l=i.success||function(){};var j=i.fail||function(){};var m=i.complete||function(){};k.key=this.key;k.output="json";this.request({url:URL_CITY_LIST,data:k,header:{content:"application/json"},method:"get",success:function(o){var p=o.data;if(p.status===0){var n=p.result;l({status:0,result:n})}else{j({status:p.status,message:p.message})}},fail:function(n){j({status:-1,message:n.errMsg||""})},complete:function(n){m(n)}})}},{key:"getDistrictByCityId",value:function c(i){var k={};var n=i.id||"";var l=i.success||function(){};var j=i.fail||function(){};var m=i.complete||function(){};k.key=this.key;k.output="json";k.id=n;this.request({url:URL_AREA_LIST,data:k,header:{content:"application/json"},method:"get",success:function(p){var q=p.data;if(q.status===0){var o=q.result;l({status:0,result:o})}else{j({status:q.status,message:q.message})}},fail:function(o){j({status:-1,message:o.errMsg||""})},complete:function(o){m(o)}})}},{key:"calculateDistance",value:function c(r){var i=r.to;var k=r.from;var m=r.mode||"walking";var o=r.success||function(s){};var n=r.fail||function(s){};var j=r.complete||function(s){};var l={};l.key=this.key;l.output="json";var p=2;if(i.length){p=i.length}var q=(l.mode=m);if(m=="straight"){l.mode="straight";k&&(l.from=k);if(i instanceof Array){var i=i.join(";");l.to=i}else{l.to=i}return this.request({url:URL_DISTANCE,data:l,success:function(t){var v=t.data;if(v.status===0){var u=v.result;var s=v.message;o({status:0,result:u,message:s})}else{n({status:v.status,message:v.message})}},fail:function(s){n({status:-1,message:"距离计算失败。"})},complete:function(s){j(s)}})}if(!(i instanceof Array)){i=[i]}if(!(i.length===2)){n({status:-1,message:"calculateDistance: 距离计算至少需要两个点。"});return}if(k||k=="undefined"){l.from=k}for(var i=i.join(";"),l.to=i,l.mode=mode="STRAIGHT",this.request({url:URL_DISTANCE,data:l,header:{content:"application/json"},method:"get",success:function(t){var u=t.data;if(u.status===0){var s=u.result;o({status:0,result:s,message:u.message})}else{n({status:u.status,message:u.message})}},fail:function(s){n({status:-1,message:s.errMsg||""})},complete:function(s){j(s)}})}},{key:"direction",value:function c(i){var j=i.mode||"transit";var v=i.to;var p=v.latitude+","+v.longitude;var w=i.from=i.location?i.location:i.from;var u=i.success||function(){};var x=i.fail||function(){};var r=i.complete||function(){};var l=i.traffic||0;var o=i.highway||0;var t=i.policy||(j=="transit"?"LEAST_TIME":(j=="driving"?"REAL_TRAFFIC":""));var k=i.plate_number||"";var q=i.departure_time||"";var n=i.waypoints?i.waypoints:("");var m=i.heading||0;var s=i.speed||null;var y={};y.key=this.key;y.output="json";if(j=="transit"){y.url=MODE[j];delete y.url}else{y.url=MODE[j]}if(!w){if(typeof this.getWxLocation=="undefind"){x({status:-2,message:"参数错误：缺少位置信息来源。"})}else{this.getWxLocation(function(z){y.from=z;y.to=p;y.traffic=l;y.plate_number=k;y.departure_time=q;y.waypoints=n;y.policy=t;y.heading=m;y.speed=s;y.from_track="0";y.callback="cb_"+Math.ceil(Math.random()*1000000);wx.request({url:MODE[j]+"?from="+y.from+"&to="+y.to+"&traffic="+y.traffic+"&plate_number="+y.plate_number+"&departure_time="+y.departure_time+"&waypoints="+y.waypoints+"&policy="+y.policy+"&heading="+y.heading+"&speed="+(y.speed||"")+"&from_track="+y.from_track+"&key="+y.key+"&callback="+y.callback,data:{},dataType:"jsonp",success:function(B){var A=B.data;if(A.status===0){var z=A.result;u({status:0,result:z})}else{x({status:A.status,message:A.message})}},fail:function(z){x({status:-1,message:z.errMsg||""})},complete:function(z){r(z)}})},x,r);return}}this.request({url:MODE[j],data:y,header:{content:"application/json"},method:"get",success:function(A){var B=A.data;if(B.status===0){var z=B.result;u({status:0,result:z})}else{x({status:B.status,message:B.message})}},fail:function(z){x({status:-1,message:z.errMsg||""})},complete:function(z){r(z)}})}}]);return b}();module.exports=QQMapWX; 